generator client {
  provider        = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id        Int      @id @default(autoincrement())
  first_name String?
  last_name  String?
  orders    Order[]
  phone_number String @unique
  nationality_id Int?

  @@map("customer")
}

model Order {
  id          Int         @id @default(autoincrement())
  order_code  String      @unique
  customer_id Int?
  comments    String?
  created_at  DateTime    @default(now())
  order_side_item OrderSideItem[]
  status_id Int     @default(1)

  // Relations
  customer    Customer?   @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  status      Status      @relation(fields: [status_id], references: [id])    
  order_item OrderItem[]

  @@map("order")  
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  order_id  Int
  quantity  Int
  dish_id   Int

  // Relations
  order     Order    @relation(fields: [order_id], references: [id], onDelete: Cascade)
  dish      Dish     @relation(fields: [dish_id], references: [id])
  order_side_item OrderSideItem[]


  @@map("order_item")
}

model OrderSideItem {
  id        Int      @id @default(autoincrement())
  order_id Int
  side_id   Int
  quantity  Int
  order_item_id Int?


  // Relations
  order     Order    @relation(fields: [order_id], references: [id], onDelete: Cascade)
  side      Side     @relation(fields: [side_id], references: [id])
  order_item OrderItem? @relation(fields: [order_item_id], references: [id], onDelete: Cascade)
  @@map("order_side_item")
}

model Dish {
  id       Int    @id @default(autoincrement())
  name     String
  price    Float

  OrderItem OrderItem[]
  @@map("dish")
}

model MenuItems { 
  id       Int    @id @default(autoincrement())
  category_id Int
  name     String
  description String
  item_variants ItemVariant[]

  @@map("menu_items")
}
model ItemVariant {
  id          Int      @id @default(autoincrement())
  item_id Int
  variant_name     String
  price Float
  is_active Boolean @default(true)

  MenuItem MenuItems @relation(fields: [item_id], references: [id], onDelete: Cascade)
  @@map("item_variants")
}

model Nationality {
  id   Int    @id @default(autoincrement())
  name String @unique

  @@map("nationality")
}

model Side {
  id   Int    @id @default(autoincrement())
  name String @unique
  cost Float
  price Float
  description String?

  SideOrderItem OrderSideItem[]
  @@map("side")
}

model Status {
  id   Int    @id @default(autoincrement())
  name String @unique

  Order Order[]
  @@map("status")
}